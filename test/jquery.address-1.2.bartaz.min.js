/*
 * jQuery Address Plugin v1.2.bartaz
 * http://www.asual.com/jquery/address/
 *
 * Copyright (c) 2009-2010 Rostislav Hristov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Date: 2010-03-23 15:08:01 +0100 (Tue, 23 Mar 2010)
 */
(function(c){c.address=function(){var A=function(a){c(c.address).trigger(c.extend(c.Event(a),function(){for(var b={},g=c.address.parameterNames(),h=0,p=g.length;h<p;h++)b[g[h]]=c.address.parameter(g[h]);return{value:c.address.value(),path:c.address.path(),pathNames:c.address.pathNames(),parameterNames:g,parameters:b,queryString:c.address.queryString()}}.call(c.address)))},v=function(a,b,g){if(g||b)c(c.address).bind(a,g||b,g&&b);return c.address},s=function(){var a=d.href.indexOf("#");return a!=-1?
T(I(t(d.href.substr(a+1),i))):""},U=function(){return"javascript"},V=function(a,b){if(j.strict)a=b?a.substr(0,1)!="/"?"/"+a:a:a==""?"/":a;return a},J=function(a,b){return u&&d.protocol=="file:"?b?f.replace(/\?/,"%3F"):f.replace(/%253F/,"?"):a},t=function(a,b){if(j.crawlable)return b?(a!=""?"!":"")+a:a.replace(/^\!/,"");return a},W=function(a){for(var b,g,h=0,p=a.childNodes.length;h<p;h++){if(a.childNodes[h].src)b=String(a.childNodes[h].src);if(g=W(a.childNodes[h]))b=g}return b},G=function(){if(!K){var a=
s(),b=f!=a;if(B&&m<523){if(C!=E.length){C=E.length;if(typeof w[C-1]!=x)f=w[C-1];F(i)}}else if(u&&m<7&&b)d.reload();else if(b){f=a;F(i)}}},F=function(a){A("change");A(a?"internalChange":"externalChange");D(X,10)},X=function(){var a=(d.pathname+(/\/$/.test(d.pathname)?"":"/")+c.address.value()).replace(/\/\//,"/").replace(/^\/$/,""),b=window[j.tracker];if(typeof b==L)b(a);else if(typeof _gaq!=x&&typeof _gaq.push==L)_gaq.push(["_trackPageview",a]);else if(typeof pageTracker!=x&&typeof pageTracker._trackPageview==
L)pageTracker._trackPageview(a);else typeof urchinTracker==L&&urchinTracker(a)},Y=function(){var a=k.contentWindow.document;a.open();a.write("<html><head><title>"+l.title+"</title><script>var "+q+' = "'+s()+'";<\/script></head></html>');a.close()},$=function(){if(!Z){Z=e;if(u&&m<8){var a=l.getElementsByTagName("frameset")[0];k=l.createElement((a?"":"i")+"frame");if(a){a.insertAdjacentElement("beforeEnd",k);a[a.cols?"cols":"rows"]+=",0";k.src=U()+":"+i;k.noResize=e;k.frameBorder=k.frameSpacing=0}else{k.src=
U()+":"+i;k.style.display="none";l.body.insertAdjacentElement("afterBegin",k)}D(function(){c(k).bind("load",function(){var b=k.contentWindow;f=typeof b[q]!=x?b[q]:"";if(f!=s()){F(i);d.hash=J(t(f,e),e)}});typeof k.contentWindow[q]==x&&Y()},50)}else if(B){if(m<418){c(l.body).append('<form id="'+q+'" style="position:absolute;top:-9999px;" method="get"></form>');N=l.getElementById(q)}if(typeof d[q]==x)d[q]={};if(typeof d[q][d.pathname]!=x)w=d[q][d.pathname].split(",")}D(function(){A("init");F(i)},1);
if(u&&m>7||!u&&"on"+H in o)if(o.addEventListener)o.addEventListener(H,G,false);else o.attachEvent&&o.attachEvent("on"+H,G);else da(G,50);c("a[rel*=address:]").address()}},ea=function(){if(o.removeEventListener)o.removeEventListener(H,G,false);else o.detachEvent&&o.detachEvent("on"+H,G)},q="jQueryAddress",L="function",x="undefined",H="hashchange",e=true,i=false,j={autoUpdate:e,crawlable:i,history:e,strict:e},n=c.browser,m=parseFloat(c.browser.version),aa=n.mozilla,u=n.msie,r=n.opera,B=n.safari,O=i,
o=function(){try{return top.document!==undefined?top:window}catch(a){return window}}(),l=o.document,E=o.history,d=o.location,da=setInterval,D=setTimeout,I=decodeURI,T=encodeURI;n=navigator.userAgent;var k,N,y=W(document),ba=y?y.indexOf("?"):-1,fa=l.title,C=E.length,K=i,Z=i,P=e,ca=e,M=i,w=[],f=s();if(u){m=parseFloat(n.substr(n.indexOf("MSIE")+4));if(l.documentMode&&l.documentMode!=m)m=l.documentMode!=8?7:8}if(O=aa&&m>=1||u&&m>=6||r&&m>=9.5||B&&m>=312){for(n=1;n<C;n++)w.push("");w.push(f);if(u&&d.hash!=
f)d.hash="#"+J(t(f,e),e);if(r)history.navigationMode="compatible";if(y&&ba!=-1){y=y.substr(ba+1).split("&");for(n=0;n<y.length;n++){r=y[n].split("=");if(/^(autoUpdate|crawlable|history|strict)$/.test(r[0]))j[r[0]]=isNaN(r[1])?/^(true|yes)$/i.test(r[1]):parseInt(r[1],10)!==0;if(/^tracker$/.test(r[0]))j[r[0]]=r[1]}}document.readyState=="complete"&&$();c($);c(window).bind("unload",ea)}else if(!O&&s()!=""||B&&m<418&&s()!=""&&d.search!=""){l.open();l.write('<html><head><meta http-equiv="refresh" content="0;url='+
d.href.substr(0,d.href.indexOf("#"))+'" /></head></html>');l.close()}else X();return{init:function(a,b){return v("init",a,b)},change:function(a,b){return v("change",a,b)},internalChange:function(a,b){return v("internalChange",a,b)},externalChange:function(a,b){return v("externalChange",a,b)},baseURL:function(){var a=d.href;if(s()!="")a=a.substr(0,a.indexOf("#"));if(/\/$/.test(a))a=a.substr(0,a.length-1);return a},strict:function(a){if(a!==undefined){j.strict=a;return this}return j.strict},crawlable:function(a){if(a!==
undefined){j.crawlable=a;return this}return j.crawlable},autoUpdate:function(a){if(a!==undefined){j.autoUpdate=a;return this}return j.autoUpdate},update:function(){M=e;this.value(f);M=i;return this},history:function(a){if(a!==undefined){j.history=a;return this}return j.history},tracker:function(a){if(a!==undefined){j.tracker=a;return this}return j.tracker},title:function(a){if(a!==undefined){a=I(a);D(function(){fa=l.title=a;if(ca&&k&&k.contentWindow&&k.contentWindow.document){k.contentWindow.document.title=
a;ca=i}if(!P&&aa)d.replace(d.href.indexOf("#")!=-1?d.href:d.href+"#");P=i},50);return this}return l.title},value:function(a){if(arguments.length>1)return this.value(arguments[0]+(arguments[1]?"?"+arguments[1]:"")+(arguments[2]?"#"+arguments[2]:""));if(a!==undefined){a=T(I(V(a,e)));if(a=="/")a="";if(f==a&&!M)return;P=e;f=a;if(j.autoUpdate||M){K=e;F(e);w[E.length]=f;if(B)if(j.history){d[q][d.pathname]=w.toString();C=E.length+1;if(m<418){if(d.search==""){N.action="#"+t(f,e);N.submit()}}else if(m<523||
f==""){var b=l.createEvent("MouseEvents");b.initEvent("click",e,e);var g=l.createElement("a");g.href="#"+t(f,e);g.dispatchEvent(b)}else d.hash="#"+t(f,e)}else d.replace("#"+t(f,e));else if(f!=s())if(j.history)d.hash="#"+J(t(f,e),e);else d.replace("#"+t(f,e));u&&m<8&&j.history&&D(Y,50);if(B)D(function(){K=i},1);else K=i}return this}if(!O)return null;return I(V(J(f,i),i))},path:function(a){if(a!==undefined){this.value(a,this.queryString(),this.fragment());return this}a=this.value();return a.indexOf("?")!=
-1?a.split("?")[0]:a.indexOf("#")!=-1?a.split("#")[0]:a},queryString:function(a){if(a!==undefined){this.value(this.path(),a,this.fragment());return this}a=this.value();var b=a.indexOf("?");if(b!=-1&&b<a.length){a=a.substr(b+1);return a.indexOf("#")!=-1?a.split("#")[0]:a}},parameter:function(a,b,g){var h,p;if(b!==undefined){var Q=this.parameterNames();p=[];for(h=0;h<Q.length;h++){var R=Q[h],z=this.parameter(R);if(typeof z=="string")z=[z];if(R==a)z=b===null||b==""?[]:g?z.concat([b]):[b];for(var S=0;S<
z.length;S++)p.push(R+"="+z[S])}c.inArray(a,Q)==-1&&p.push(a+"="+b);this.queryString(p.join("&"));return this}if(b=this.queryString()){p=b.split("&");b=[];for(h=0;h<p.length;h++){g=p[h].split("=");g[0]==a&&b.push(g[1])}if(b.length!==0)return b.length!=1?b:b[0]}},pathNames:function(){var a=this.path(),b=a.split("/");if(a.substr(0,1)=="/"||a.length===0)b.splice(0,1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1);return b},parameterNames:function(){var a=this.value(),b=a.indexOf("?"),g=[];if(b!=
-1){a=a.substr(b+1);if(a!=""&&a.indexOf("=")!=-1){a=a.split("&");for(b=0;b<a.length;b++){var h=a[b].split("=")[0];c.inArray(h,g)==-1&&g.push(h)}}}return g},fragment:function(a){if(a!==undefined){this.value(this.path(),this.queryString(),a);return this}a=this.value();var b=a.indexOf("#");if(b!=-1&&b<a.length)return a.substr(b+1)}}}();c.fn.address=function(A){var v=function(){var s=A?A.call(this):/address:/.test(c(this).attr("rel"))?c(this).attr("rel").split("address:")[1].split(" ")[0]:c(this).attr("href").replace(/^#\!?/,
"");c.address.value(s);return false};c(this).click(v).live("click",v)}})(jQuery);
